"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[5080],{8286:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"Integration/Hubspot","title":"Hubspot","description":"Introduction","source":"@site/docs/Integration/Hubspot.md","sourceDirName":"Integration","slug":"/Integration/Hubspot","permalink":"/Agent-First-Organization/docs/Integration/Hubspot","draft":false,"unlisted":false,"editUrl":"https://github.com/arklexai/Agent-First-Organization/tree/main/docs/docs/Integration/Hubspot.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Integration","permalink":"/Agent-First-Organization/docs/Integration/intro"},"next":{"title":"Introduction","permalink":"/Agent-First-Organization/docs/Evaluation/intro"}}');var s=t(4848),o=t(8453);const a={},r="Hubspot",c={},d=[{value:"Introduction",id:"introduction",level:2},{value:"Setup",id:"setup",level:2},{value:"Implementation",id:"implementation",level:2},{value:"find_contact_by_email(email, chat, **kwargs):",id:"find_contact_by_emailemail-chat-kwargs",level:3},{value:"create_ticket(contact_information, issue, **kwargs):",id:"create_ticketcontact_information-issue-kwargs",level:3},{value:"find_owner_id_by_contact_id(cus_cid, **kwargs):",id:"find_owner_id_by_contact_idcus_cid-kwargs",level:3},{value:"check_available(owner_id, time_zone, meeting_date, **kwargs):",id:"check_availableowner_id-time_zone-meeting_date-kwargs",level:3},{value:"create_meeting(cus_fname, cus_lname, cus_email, meeting_date, meeting_start_time, duration, slug, bt_slots_ux, time_zone, **kwargs):",id:"create_meetingcus_fname-cus_lname-cus_email-meeting_date-meeting_start_time-duration-slug-bt_slots_ux-time_zone-kwargs",level:3},{value:"Taskgraph",id:"taskgraph",level:2},{value:"Running the chatbot",id:"running-the-chatbot",level:2},{value:"Sample conversation",id:"sample-conversation",level:2}];function l(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"hubspot",children:"Hubspot"})}),"\n",(0,s.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,s.jsxs)(n.p,{children:["HubSpot is a platform that connects your marketing, sales, and services tools to a unified ",(0,s.jsx)(n.strong,{children:"CRM"})," database.\nIn this framework, the feature of the Hubspot is integrated for users to better manage the relationship between customers."]}),"\n",(0,s.jsx)(n.h2,{id:"setup",children:"Setup"}),"\n",(0,s.jsx)(n.p,{children:"Setting up the private app"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Login to ",(0,s.jsx)(n.a,{href:"https://app.hubspot.com/login",children:"Hubspot"})," and then go to \u2699 (Settings icon) on the top right"]}),"\n",(0,s.jsxs)(n.li,{children:["On the left navbar, go to ",(0,s.jsx)(n.strong,{children:"Integrations"})," > ",(0,s.jsx)(n.strong,{children:"Private Apps"})]}),"\n",(0,s.jsx)(n.li,{children:"Create a new private app"}),"\n",(0,s.jsx)(n.li,{children:'Give a name for the new private app ("agent-integration"), upload a logo, and give some descriptions if you want'}),"\n",(0,s.jsxs)(n.li,{children:["Go to scopes to add the following necessary scopes:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"crm.lists.read"}),"\n",(0,s.jsx)(n.li,{children:"crm.lists.write"}),"\n",(0,s.jsx)(n.li,{children:"crm.objects.contacts.read"}),"\n",(0,s.jsx)(n.li,{children:"crm.objects.contacts.write"}),"\n",(0,s.jsx)(n.li,{children:"crm.schemas.contacts.read"}),"\n",(0,s.jsx)(n.li,{children:"tickets"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"The process of creating new private app is finished. The access token could be obtained."}),"\n",(0,s.jsxs)(n.li,{children:["Adding relevant data for your company using several ways, such as ",(0,s.jsx)(n.strong,{children:"Import from files"}),", ",(0,s.jsx)(n.strong,{children:"Sync from files"})," and ",(0,s.jsx)(n.strong,{children:"Migrate from your data."})]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"implementation",children:"Implementation"}),"\n",(0,s.jsx)(n.h3,{id:"find_contact_by_emailemail-chat-kwargs",children:"find_contact_by_email(email, chat, **kwargs):"}),"\n",(0,s.jsx)(n.p,{children:"This function aims to find the existing customer by their emails and update the last activity date."}),"\n",(0,s.jsx)(n.p,{children:"Inputs:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"email"}),": the email address of the customer (It should be noted that email address is also a unique identifier for each customer)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"chat"}),": the chat content that customer communicates with the chatbot"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"**kwargs"}),": contains the ",(0,s.jsx)(n.strong,{children:"access token"})," for the hubspot private app"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Output:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"contact_info_properties"}),": id, email, first_name and last_name of the contact of the existing customer"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"There are several steps for the implementation of this function:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Detect whether the customer is the existing one using ",(0,s.jsx)(n.code,{children:"email"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'public_object_search_request = PublicObjectSearchRequest(\n      filter_groups=[\n          {\n              "filters": [\n                  {\n                      "propertyName": "email",\n                      "operator": "EQ",\n                      "value": email\n                  }\n              ]\n          }\n      ]\n  )\n\ntry:\n  contact_search_response = api_client.crm.contacts.search_api.do_search(public_object_search_request=public_object_search_request)\n  logger.info("Found contact by email: {}".format(email))\n  contact_search_response = contact_search_response.to_dict()\n'})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["If the user is not an existing customer, ",(0,s.jsx)(n.code,{children:"USER_NOT_FOUND_ERROR"})," will be returned. If the user is the existing customer, the response of search_api is shown below.\nThe structure of a contact is demonstrated inside the ",(0,s.jsx)(n.code,{children:"results"})," field."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"{'paging': None,\n 'results': [{'archived': False,\n              'archived_at': None,\n              'created_at': datetime.datetime(2025, 2, 15, 21, 23, 10, 453000, tzinfo=tzutc()),\n              'id': '84246479604',\n              'properties': {'createdate': '2025-02-15T21:23:10.453Z',\n                             'email': 'sarah@gmail.com',\n                             'firstname': 'Sarah',\n                             'hs_object_id': '84246479604',\n                             'lastmodifieddate': '2025-02-23T22:15:05.802Z',\n                             'lastname': 'Mark'},\n              'properties_with_history': None,\n              'updated_at': datetime.datetime(2025, 2, 23, 22, 15, 5, 802000, tzinfo=tzutc())}],\n 'total': 1}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["In Hubspot the detailed information of the ",(0,s.jsx)(n.strong,{children:"contact"})," is looked like below:"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"hubspot_contact.png",src:t(3192).A+"",width:"2755",height:"1473"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Then a ",(0,s.jsx)(n.strong,{children:"communication"})," object will be created, whose content is ",(0,s.jsx)(n.code,{children:"chat"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"      if contact_search_response['total'] == 1:\n          contact_id = contact_search_response['results'][0]['id']\n          communication_data = SimplePublicObjectInputForCreate(\n              properties = {\n                  \"hs_communication_channel_type\": \"CUSTOM_CHANNEL_CONVERSATION\",\n                  \"hs_communication_body\": chat,\n                  \"hs_communication_logged_from\": \"CRM\",\n                  \"hs_timestamp\": datetime.now(timezone.utc).isoformat(),\n              }\n          )\n          contact_info_properties = {\n              'contact_id': contact_id,\n              'contact_email': email,\n              'contact_first_name': contact_search_response['results'][0]['properties'].get('firstname'),\n              'contact_last_name': contact_search_response['results'][0]['properties'].get('lastname')\n          }\n          try:\n              communication_creation_response = api_client.crm.objects.communications.basic_api.create(communication_data)\n              communication_creation_response = communication_creation_response.to_dict()\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The structure of the ",(0,s.jsx)(n.strong,{children:"communication"})," object is shown below:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:" {'archived': False,\n 'archived_at': None,\n 'created_at': datetime.datetime(2025, 2, 25, 0, 26, 48, 751000, tzinfo=tzutc()),\n 'id': '81116227304',\n 'properties': {'hs_body_preview': 'I want to know more about your product: '\n                                   'Adam',\n                'hs_body_preview_html': '<html>\\n'\n                                        ' <head></head>\\n'\n                                        ' <body>\\n'\n                                        ' I want to know more about your '\n                                        'product: Adam\\n'\n                                        ' </body>\\n'\n                                        '</html>',\n                'hs_body_preview_is_truncated': 'false',\n                'hs_communication_body': 'I want to know more about your '\n                                         'product: Adam',\n                'hs_communication_channel_type': 'CUSTOM_CHANNEL_CONVERSATION',\n                'hs_communication_logged_from': 'CRM',\n                'hs_createdate': '2025-02-25T00:26:48.751Z',\n                'hs_lastmodifieddate': '2025-02-25T00:26:48.751Z',\n                'hs_object_id': '81116227304',\n                'hs_object_source': 'INTEGRATION',\n                'hs_object_source_id': '8190657',\n                'hs_object_source_label': 'INTEGRATION',\n                'hs_timestamp': '2025-02-25T00:26:48.370Z'},\n 'properties_with_history': None,\n 'updated_at': datetime.datetime(2025, 2, 25, 0, 26, 48, 751000, tzinfo=tzutc())}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["On Hubspot you could see a ",(0,s.jsx)(n.strong,{children:"communication"})," object is correspondingly created:"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"hubspot_communication.png",src:t(8931).A+"",width:"2645",height:"600"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Associate the ",(0,s.jsx)(n.strong,{children:"created communication"})," with the ",(0,s.jsx)(n.strong,{children:"contact"}),".\nAfter associating, the ",(0,s.jsx)(n.code,{children:"'lastmodifieddate'"})," and ",(0,s.jsx)(n.code,{children:"'updated_at'"})," of contact will be updated accordingly.:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'communication_id = communication_creation_response[\'id\']\nassociation_spec = [\n      AssociationSpec(\n              association_category="HUBSPOT_DEFINED",\n              association_type_id=82\n          )\n]\ntry:\n  association_creation_response = api_client.crm.associations.v4.basic_api.create(\n          object_type="contact",\n          object_id=contact_id,\n          to_object_type="communication",\n          to_object_id=communication_id,\n          association_spec=association_spec\n  )\n'})}),"\n",(0,s.jsx)(n.p,{children:"The structure of the association object is shown below:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"{'from_object_id': '84246479604',\n 'from_object_type_id': '0-1',\n 'labels': [],\n 'to_object_id': '81116227304',\n 'to_object_type_id': '0-18'}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["At the same time, ",(0,s.jsx)(n.code,{children:"Last Activity Date"})," on the ",(0,s.jsx)(n.strong,{children:"contact"})," information page is also updated as well:"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"hubspot_updated_date.png",src:t(3406).A+"",width:"2860",height:"1480"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"create_ticketcontact_information-issue-kwargs",children:"create_ticket(contact_information, issue, **kwargs):"}),"\n",(0,s.jsxs)(n.p,{children:["When users need technical support/repair service/exchange service, the function will be called. This function is used to create the ticket only for existing customers after calling ",(0,s.jsx)(n.code,{children:"find_contact_by_email"})," function."]}),"\n",(0,s.jsx)(n.p,{children:"Inputs:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"cus_cid"}),": ",(0,s.jsx)(n.code,{children:"id"})," of the contact of the existing customer returned from ",(0,s.jsx)(n.code,{children:"find_contact_by_email"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"issue"}),": the issue that the customer has for the product"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"**kwargs"}),": contains the ",(0,s.jsx)(n.strong,{children:"access token"})," for the hubspot private app"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Output:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"ticket_id"}),": ",(0,s.jsx)(n.code,{children:"id"})," of ticket for the existing customer"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"There are several steps for the implementation of this function:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Create a ",(0,s.jsx)(n.strong,{children:"ticket"})," for the existing customer:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'  timestamp = datetime.now().strftime("%Y-%m-%dT%H:%M:%S.%fZ")[:-3] + "Z"\n  subject_name = "Issue of " + cus_cid + " at " + timestamp\n  ticket_properties = {\n      \'hs_pipeline_stage\': 1,\n      \'content\': issue,\n      \'subject\': subject_name\n  }\n  ticket_for_create = SimplePublicObjectInputForCreate(properties=ticket_properties)\n  try:\n      ticket_creation_response = api_client.crm.tickets.basic_api.create(simple_public_object_input_for_create=ticket_for_create)\n      ticket_creation_response = ticket_creation_response.to_dict()\n'})}),"\n",(0,s.jsxs)(n.p,{children:["The structure of the created ",(0,s.jsx)(n.strong,{children:"ticket"})," is like:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"{'archived': False,\n 'archived_at': None,\n 'created_at': datetime.datetime(2025, 2, 25, 0, 35, 5, 747000, tzinfo=tzutc()),\n 'id': '33397362407',\n 'properties': {'content': 'Issue in installing the DUST-E robot',\n                'createdate': '2025-02-25T00:35:05.747Z',\n                'hs_helpdesk_sort_timestamp': '2025-02-25T00:35:05.747Z',\n                'hs_is_visible_in_help_desk': 'true',\n                'hs_last_message_from_visitor': 'false',\n                'hs_lastmodifieddate': '2025-02-25T00:35:05.747Z',\n                'hs_num_associated_companies': '0',\n                'hs_num_associated_conversations': '0',\n                'hs_num_times_contacted': '0',\n                'hs_object_id': '33397362407',\n                'hs_object_source': 'INTEGRATION',\n                'hs_object_source_id': '8190657',\n                'hs_object_source_label': 'INTEGRATION',\n                'hs_pipeline': '0',\n                'hs_pipeline_stage': '1',\n                'hs_ticket_id': '33397362407',\n                'num_notes': '0',\n                'subject': 'Issue of 84246479604 at 2025-02-24T19:35:05.4180Z'},\n 'properties_with_history': None,\n 'updated_at': datetime.datetime(2025, 2, 25, 0, 35, 5, 747000, tzinfo=tzutc())}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["On Hubspot, you could see the detailed information of a ",(0,s.jsx)(n.strong,{children:"ticket"}),":"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"hubspot_ticket.png",src:t(8182).A+"",width:"2859",height:"1471"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Associate the created ",(0,s.jsx)(n.strong,{children:"ticket"})," with the ",(0,s.jsx)(n.strong,{children:"contact"}),". It should be noted that ",(0,s.jsx)(n.code,{children:"'lastmodifieddate'"})," and ",(0,s.jsx)(n.code,{children:"'updated_at'"})," of contact will be updated after logging a ticket\n(On Hubspot, ",(0,s.jsx)(n.code,{children:"Last Activity Date"})," of the ",(0,s.jsx)(n.strong,{children:"contact"})," is also updated:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'ticket_id = ticket_creation_response[\'id\']\nassociation_spec = [\n  AssociationSpec(\n              association_category="HUBSPOT_DEFINED",\n              association_type_id=15\n      )\n]\ntry:\n  association_creation_response = api_client.crm.associations.v4.basic_api.create(\n      object_type="contact",\n      object_id=cus_cid,\n      to_object_type="ticket",\n      to_object_id=ticket_id,\n      association_spec=association_spec\n  )\n'})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"find_owner_id_by_contact_idcus_cid-kwargs",children:"find_owner_id_by_contact_id(cus_cid, **kwargs):"}),"\n",(0,s.jsx)(n.p,{children:"The function finds the owner_id of the customer based on the existing contact."}),"\n",(0,s.jsx)(n.p,{children:"Inputs:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"cus_cid"}),": ",(0,s.jsx)(n.code,{children:"id"})," of the contact of the existing customer returned from ",(0,s.jsx)(n.code,{children:"find_contact_by_email"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"**kwargs"}),": contains the ",(0,s.jsx)(n.strong,{children:"access token"})," for the hubspot private app"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Output:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"owner_id"}),": id of the owner corresponding to the customer"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Get the ",(0,s.jsx)(n.code,{children:"owner_id"})," from the properties of the contact:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'    get_owner_id_response = api_client.api_request(\n            {\n                "path": "/crm/v3/objects/contacts/{}".format(cus_cid),\n                "method": "GET",\n                "headers": {\n                    \'Content-Type\': \'application/json\'\n                },\n                "qs": {\n                    "properties": \'hubspot_owner_id\'\n                }\n            }\n\n        )\n    get_owner_id_response = get_owner_id_response.json()\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"hubspot_owner.png",src:t(7333).A+"",width:"2864",height:"1204"})}),"\n",(0,s.jsx)(n.h3,{id:"check_availableowner_id-time_zone-meeting_date-kwargs",children:"check_available(owner_id, time_zone, meeting_date, **kwargs):"}),"\n",(0,s.jsx)(n.p,{children:"This function aims to search for the unavailable slots of the owner."}),"\n",(0,s.jsx)(n.p,{children:"Inputs:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"owner_id"}),": id of the owner."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"time_zone"}),": the timezone of the customer's location"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"meeting_date"}),": the date when customer want to schedule a meeting"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"**kwargs"}),": contains the ",(0,s.jsx)(n.strong,{children:"access token"})," for the hubspot private app"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Output:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"meeting_link_related_info"}),": the available time slots (milliseconds) of the owner"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"To achieve the goal of the function, several steps are implemented:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Using the ",(0,s.jsx)(n.em,{children:"owner_id"})," to retrieve the meeting scheduler link of the owner. If there is no corresponding link of that owner,\n",(0,s.jsx)(n.code,{children:"MEETING_LINK_UNFOUND_ERROR"})," will be returned."]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'        meeting_link_response = api_client.api_request(\n            {\n                "path": "/scheduler/v3/meetings/meeting-links",\n                "method": "GET",\n                "headers": {\n                    \'Content-Type\': \'application/json\'\n                },\n                "qs": {\n                    \'organizerUserId\': owner_id\n                }\n            }\n        )\n        meeting_link_response = meeting_link_response.json()\n\n        if meeting_link_response.get(\'total\') == 0:\n            return MEETING_LINK_UNFOUND_ERROR\n        else:\n            meeting_links = meeting_link_response[\'results\'][0]\n'})}),"\n",(0,s.jsx)(n.p,{children:"The meeting scheduler link on hubspot is like below:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"hubspot_meeting_1.png",src:t(8007).A+"",width:"2876",height:"1541"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["After getting the meeting link of the owner, ",(0,s.jsx)(n.code,{children:"slug"})," is used to get the unavailable time slots of the owner:"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'            availability_response = api_client.api_request(\n                {\n                    "path": "/scheduler/v3/meetings/meeting-links/book/{}".format(meeting_slug),\n                    "method": "GET",\n                    "headers": {\n                        \'Content-Type\': \'application/json\'\n                    },\n                    "qs": {\n                        \'timezone\': time_zone\n                    }\n                }\n            )\n            cal = parsedatetime.Calendar()\n            time_struct, _ = cal.parse(meeting_date)\n            meeting_date = datetime(*time_struct[:3])\n            availability_response = availability_response.json()\n            busy_times = availability_response[\'allUsersBusyTimes\'][0][\'busyTimes\']\n'})}),"\n",(0,s.jsx)(n.p,{children:"The unavailable time slots will not be shown on the meeting scheduler on hubspot. It is very clear to see the difference comparing to the above picture."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"hubspot_meeting_2.png",src:t(7372).A+"",width:"2871",height:"1525"})}),"\n",(0,s.jsx)(n.h3,{id:"create_meetingcus_fname-cus_lname-cus_email-meeting_date-meeting_start_time-duration-slug-bt_slots_ux-time_zone-kwargs",children:"create_meeting(cus_fname, cus_lname, cus_email, meeting_date, meeting_start_time, duration, slug, bt_slots_ux, time_zone, **kwargs):"}),"\n",(0,s.jsx)(n.p,{children:"This function will help the customer to schedule a meeting"}),"\n",(0,s.jsx)(n.p,{children:"Inputs:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"cus_fname"}),": the first name of the customer."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"cus_lname"}),": the last name of the customer."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"cus_email"}),": the email address of the customer"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"meeting_date"}),": the date when customer want to schedule a meeting"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"meeting_start_time"}),": the exact time the customer wish to begin"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"duration"}),": the duration of the meeting (e.g. 15, 30, 60 minutes)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"slug"}),": the slug of the meeting link"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"bt_slots_ux"}),": the unavailable time slots of the representative (unix form)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"time_zone"}),": the timezone of the customer's location"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"**kwargs"}),": contains the ",(0,s.jsx)(n.strong,{children:"access token"})," for the hubspot private app"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Output:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"meeting_confirmation_info"}),": the scheduled meeting information"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Firstly, the start time of the meeting will be checked within the unavailable slots.\nIf the ",(0,s.jsx)(n.code,{children:"start_time"})," and ",(0,s.jsx)(n.code,{children:"end_time"})," of the meeting are in the unavailable slots, ",(0,s.jsx)(n.code,{children:"UNAVAILABLE_ERROR"})," will be returned."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"    meeting_date = parse_natural_date(meeting_date, timezone=time_zone, date_input=True)\n    meeting_start_time = parse_natural_date(meeting_start_time, meeting_date, timezone=time_zone)\n    meeting_start_time = int(meeting_start_time.timestamp() * 1000)\n\n\n    duration = int(duration)\n    duration = int(timedelta(minutes=duration).total_seconds() * 1000)\n\n    meeting_end_time = meeting_start_time + duration\n\n    bt_slots_ux = json.loads(bt_slots_ux)\n    for time_slot in bt_slots_ux:\n        if meeting_start_time >= time_slot['start'] and meeting_start_time < time_slot['end']:\n            return UNAVAILABLE_ERROR\n        elif meeting_end_time >= time_slot['start'] and meeting_end_time <= time_slot['end']:\n            return UNAVAILABLE_ERROR\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Then, schedule the meeting with the owner:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'    try:\n        create_meeting_response = api_client.api_request(\n            {\n                "path": "/scheduler/v3/meetings/meeting-links/book",\n                "method": "POST",\n                "body": {\n                    "slug": slug,\n                    "duration": duration,\n                    "startTime": meeting_start_time,\n                    "email": cus_email,\n                    "firstName": cus_fname,\n                    "lastName": cus_lname,\n                    "timezone": time_zone,\n                    "locale": "en-us",\n                },\n                "qs": {\n                    \'timezone\': time_zone\n                }\n            }\n\n        )\n        create_meeting_response = create_meeting_response.json()\n        return json.dumps(create_meeting_response)\n    except ApiException as e:\n        logger.info("Exception when scheduling a meeting: %s\\n" % e)\n'})}),"\n",(0,s.jsx)(n.p,{children:"Because hubspot is synchronized with Google Calendar, the meeting information will also be shown on the calendar:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"hubspot_cal.png",src:t(3136).A+"",width:"2703",height:"1449"})}),"\n",(0,s.jsx)(n.h2,{id:"taskgraph",children:"Taskgraph"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Fields"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"nodes"}),": The nodes in the TaskGraph, each node contains the worker/tool name, task, and the directed attribute."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"edges"}),": The edges in the TaskGraph, each edge contains the intent, weight, pred, definition, and sample_utterances.\nThe edge defines the connection between two nodes"]}),"\n",(0,s.jsx)(n.li,{children:"Fields in the config file: role, user_objective, builder_objective, domain, intro, task_docs, rag_docs, tasks, workers, tools"}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"nluapi"}),": It will automatically add the default NLU api which use the ",(0,s.jsx)(n.code,{children:"NLUOpenAIAPI"})," service defined under ",(0,s.jsx)(n.code,{children:"./arklex/orchestrator/NLU/api.py"})," file. If you want to customize the NLU api, you can change the ",(0,s.jsx)(n.code,{children:"nluapi"})," field to your own NLU api url."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"slotfillapi"}),": It will automatically add the default SlotFill api which use the ",(0,s.jsx)(n.code,{children:"SlotFillOpenAIAPI"})," service defined under ",(0,s.jsx)(n.code,{children:"./arklex/orchestrator/NLU/api.py"})," file. If you want to customize the SlotFill api, you can change the ",(0,s.jsx)(n.code,{children:"slotfillapi"})," field to your own SlotFill api url."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["In the ",(0,s.jsx)(n.strong,{children:"Hubspot Integration"}),", there are two intents for users communicating the chatbot:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["When users have ",(0,s.jsx)(n.strong,{children:"questions"})," about the product, the chatbot will firstly ask for users' email to detect\nwhether they are existing customers. At the same time, it will update the contact's last activity date if the user is an existing customer.\nThen it will use ",(0,s.jsx)(n.code,{children:"FaissRAGWorker"})," to generate answer for user's question. So the basic flow for this case is: ",(0,s.jsx)(n.code,{children:"start_node -> search_customer -> FaissRAGWorker"})]}),"\n",(0,s.jsxs)(n.li,{children:["When users need ",(0,s.jsx)(n.strong,{children:"technical support/repair service/exchange service"})," about the product, the chatbot will firstly ask for users' email to detect\nwhether they are existing customers. At the same time, it will update the contact's last activity date if the user is an existing customer.\nThen it will move to create a ticket for the corresponding issue and head it to the technician support team.\nSo the basic flow for this case is: ",(0,s.jsx)(n.code,{children:"start_node -> search_customer -> create_ticket"})]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"So the taskgraph to handle these two cases is shown below:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "nodes": [\n    [\n      "0",\n      {\n        "resource": {\n          "id": "be303c9a-a902-4de9-bbb2-61343e59e888",\n          "name": "MessageWorker"\n        },\n        "attribute": {\n          "value": "Hello! Welcome to Richtech. How can I assist you today?",\n          "task": "start message",\n          "directed": false\n        },\n        "limit": 1,\n        "type": "start"\n      }\n    ],\n    [\n      "1",\n      {\n        "resource": {\n          "id": "ddbe6adc-cd0e-40bc-8a95-91cb69ed807b",\n          "name": "search_customer"\n        },\n        "attribute": {\n          "value": "",\n          "task": "Detect whether this is the existing customer from our hubspot platform",\n          "directed": false\n        },\n        "limit": 1\n      }\n    ],\n    [\n      "2",\n      {\n        "resource": {\n          "id": "40f05456-525c-4d9d-ac37-54482d6b220b",\n          "name": "FaissRAGWorker"\n        },\n        "attribute": {\n          "value": "",\n          "task": "Retrieve information from the documentations to answer customer question",\n          "directed": false\n        },\n        "limit": 1\n      }\n    ],\n    [\n      "3",\n      {\n        "resource": {\n          "id": "ddbe6adc-cd0e-40bc-8a95-91cb69ed807b",\n          "name": "search_customer"\n        },\n        "attribute": {\n          "value": "",\n          "task": "Detect whether this is the existing customer from our hubspot platform",\n          "directed": false\n        },\n        "limit": 1\n      }\n    ],\n    [\n      "4",\n      {\n        "resource": {\n          "id": "aa8dd20d-fda7-475b-91ce-8c5fc356a2b7",\n          "name": "create_ticket"\n        },\n        "attribute": {\n          "value": "",\n          "task": "create the ticket for the existing customer",\n          "directed": false\n        },\n        "limit": 1\n      }\n    ],\n    [\n      "5",\n      {\n        "resource": {\n          "id": "ddbe6adc-cd0e-40bc-8a95-91cb69ed807b",\n          "name": "search_customer"\n        },\n        "attribute": {\n          "value": "",\n          "task": "Detect whether this is the existing customer from our hubspot platform",\n          "directed": false\n        },\n        "limit": 1\n      }\n    ],\n    [\n      "6",\n      {\n        "resource": {\n          "id": "11860b97-dfcf-4f1d-9e44-8767c50fd371",\n          "name": "find_owner_id_by_contact_id"\n        },\n        "attribute": {\n          "value": "",\n          "task": "find the owner id of the contact",\n          "directed": false\n        },\n        "limit": 1\n      }\n    ],\n    [\n      "7",\n      {\n        "resource": {\n          "id": "8a6784c2-a130-4eb4-9924-4f4c58f4bf9d",\n          "name": "check_available"\n        },\n        "attribute": {\n          "value": "",\n          "task": "Show customer the busy time the representative has",\n          "directed": false\n        },\n        "limit": 1\n      }\n    ],\n    [\n      "8",\n      {\n        "resource": {\n          "id": "e86daf21-41a3-40b2-9695-3ed59be46cc4",\n          "name": "create_meeting"\n        },\n        "attribute": {\n          "value": "",\n          "task": "schedule a meeting for the customer to the specific representative",\n          "directed": false\n        },\n        "limit": 1\n      }\n    ]\n  ],\n  "edges": [\n    [\n      "0",\n      "1",\n      {\n        "intent": "User has questions about the product",\n        "attribute": {\n          "weight": 1,\n          "pred": true,\n          "definition": "",\n          "sample_utterances": []\n        }\n      }\n    ],\n    [\n      "1",\n      "2",\n      {\n        "intent": "none",\n        "attribute": {\n          "weight": 1,\n          "pred": true,\n          "definition": "",\n          "sample_utterances": []\n        }\n      }\n    ],\n    [\n      "0",\n      "3",\n      {\n        "intent": "User need technical support/User need repair service / User need exchange service",\n        "attribute": {\n          "weight": 1,\n          "pred": true,\n          "definition": "",\n          "sample_utterances": []\n        }\n      }\n    ],\n    [\n      "3",\n      "4",\n      {\n        "intent": "none",\n        "attribute": {\n          "weight": 1,\n          "pred": true,\n          "definition": "",\n          "sample_utterances": []\n        }\n      }\n    ],\n    [\n      "0",\n      "5",\n      {\n        "intent": "User want to schedule a meeting with the representative",\n        "attribute": {\n          "weight": 1,\n          "pred": true,\n          "definition": "",\n          "sample_utterances": []\n        }\n      }\n    ],\n    [\n      "5",\n      "6",\n      {\n        "intent": "none",\n        "attribute": {\n          "weight": 1,\n          "pred": true,\n          "definition": "",\n          "sample_utterances": []\n        }\n      }\n    ],\n    [\n      "6",\n      "7",\n      {\n        "intent": "none",\n        "attribute": {\n          "weight": 1,\n          "pred": true,\n          "definition": "",\n          "sample_utterances": []\n        }\n      }\n    ],\n    [\n      "7",\n      "8",\n      {\n        "intent": "none",\n        "attribute": {\n          "weight": 1,\n          "pred": true,\n          "definition": "",\n          "sample_utterances": []\n        }\n      }\n    ]\n  ],\n  "role": "customer service assistant",\n  "user_objective": "The customer service assistant helps users with customer service inquiries. It can provide information about products, services, and policies, as well as help users resolve issues and complete transactions.",\n  "builder_objective": "The customer service assistant helps to request customer\'s contact information.",\n  "domain": "robotics and automation",\n  "intro": "Richtech Robotics\'s headquarter is in Las Vegas; the other office is in Austin. Richtech Robotics provide worker robots (ADAM, ARM, ACE), delivery robots (Matradee, Matradee X, Matradee L, Richie), cleaning robots (DUST-E SX, DUST-E MX) and multipurpose robots (skylark). Their products are intended for business purposes, but not for home purpose; the ADAM robot is available for purchase and rental for multiple purposes. This robot bartender makes tea, coffee and cocktails. Richtech Robotics also operate the world\'s first robot milk tea shop, ClouTea, in Las Vegas (www.cloutea.com), where all milk tea beverages are prepared by the ADAM robot. The delivery time will be one month for the delivery robot, 2 weeks for standard ADAM, and two months for commercial cleaning robot. ",\n  "task_docs": [\n  ],\n  "rag_docs": [\n  ],\n  "tasks": [],\n  "tools": [\n    {\n      "id": "ddbe6adc-cd0e-40bc-8a95-91cb69ed807b",\n      "name": "find_contact_by_email",\n      "path": "hubspot.find_contact_by_email",\n      "fixed_args": { "access_token": "<access_token>" }\n    },\n    {\n      "id": "aa8dd20d-fda7-475b-91ce-8c5fc356a2b7",\n      "name": "create_ticket",\n      "path": "hubspot.create_ticket",\n      "fixed_args": { "access_token": "<access_token>" }\n    },\n    {\n      "id": "8a6784c2-a130-4eb4-9924-4f4c58f4bf9d",\n      "name": "check_available",\n      "path": "hubspot.check_available",\n      "fixed_args": { "access_token": "<access_token>" }\n    },\n    {\n      "id": "e86daf21-41a3-40b2-9695-3ed59be46cc4",\n      "name": "create_meeting",\n      "path": "hubspot.create_meeting",\n      "fixed_args": { "access_token": "<access_token>" }\n    },\n    {\n      "id": "1437160f-6036-4fc9-99db-0e45afabd03c",\n      "name": "find_owner_by_owner_id",\n      "path": "hubspot.find_owner_by_owner_id",\n      "fixed_args": { "access_token": "<access_token>" }\n    },\n    {\n      "id": "11860b97-dfcf-4f1d-9e44-8767c50fd371",\n      "name": "find_owner_id_by_contact_id",\n      "path": "hubspot.find_owner_id_by_contact_id",\n      "fixed_args": { "access_token": "<access_token>" }\n    }\n  ],\n  "workers": [\n    {\n      "id": "be303c9a-a902-4de9-bbb2-61343e59e888",\n      "name": "MessageWorker",\n      "path": "message_worker.py"\n    },\n    {\n      "id": "40f05456-525c-4d9d-ac37-54482d6b220b",\n      "name": "FaissRAGWorker",\n      "path": "faiss_rag_worker.py"\n    },\n    {\n      "id": "b10555ac-0930-42c0-9016-6605f956e411",\n      "name": "DefaultWorker",\n      "path": "default_worker.py"\n    }\n  ],\n  "nluapi": "",\n  "slotfillapi": ""\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"running-the-chatbot",children:"Running the chatbot"}),"\n",(0,s.jsxs)(n.p,{children:["When the taskgraph is generated, you could use the following command to run the chatbot (suppose the ",(0,s.jsx)(n.code,{children:"./examples/hubspot"})," contains the taskgraph):\n",(0,s.jsx)(n.code,{children:"python run.py --input-dir ./examples/hubspot"})]}),"\n",(0,s.jsx)(n.h2,{id:"sample-conversation",children:"Sample conversation"}),"\n",(0,s.jsx)(n.p,{children:"(1) 1st case (When user has questions about the product)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'Bot: Hello! Welcome to Richtech. How can I assist you today?\nCustomer: I want to know more about your product: Adam\nBot: "Thanks for your interest in the ADAM robot! Could you please provide your email or phone number so we can send you more detailed information?"\nCustomer: "sarah@gmail.com"\nBot: The ADAM robot is a versatile worker robot available for both purchase and rental. It can serve multiple purposes, including making tea, coffee, and cocktails. It\'s perfect for businesses looking to enhance their service offerings with a robotic bartender. If you have any specific questions or need further details, feel free to ask!"\nCustomer: How much is the Adam?\nBot: The pricing for the ADAM robot can vary based on the specific configuration and requirements for your business. To provide you with the most accurate pricing, could you please share more details about your intended use or any specific features you are interested in? Alternatively, I can have a sales representative contact you with detailed pricing information.\n'})}),"\n",(0,s.jsx)(n.p,{children:"(2) 2nd case (When user needs technical support/repair service/exchange service)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'Bot: Hello! Welcome to Richtech. How can I assist you today?\nCustomer: I have a issue in installing the DUST-E robot\nBot: Thank you for reaching out about the issue with installing the DUST-E robot. To assist you further, could you please provide your email or phone number? This will help us get in touch with you and offer more detailed support.\nCustomer: "sarah@gmail.com"\nBot: Thank you, Sarah. I\'ve created a support ticket for your issue with installing the DUST-E robot. Our team will reach out to you shortly to assist you further. Your ticket ID is 20616280431. If you have any more questions or need further assistance, feel free to ask!\n'})})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},3136:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/hubspot_cal-0ac491d61ea68c7934b4b69c851f4a3e.png"},8931:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/hubspot_communication-2a04312db52808407c8f0fbe17cb5653.png"},3192:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/hubspot_contact-1394c9bc2b233d9659d4d69e9ed69b88.png"},8007:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/hubspot_meeting_1-1f8530eda42f19905f92df18d6194701.png"},7372:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/hubspot_meeting_2-8c5bf868158c1c53c38f74310aaedb2c.png"},7333:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/hubspot_owner-2322c6f5b33704374cc0558ce91e8c21.png"},8182:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/hubspot_ticket-d96729fa4f8fd21165befda8bed707e5.png"},3406:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/hubspot_updated_date-fddc2cd1b53150f6d759cf8a3ac7b286.png"},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>r});var i=t(6540);const s={},o=i.createContext(s);function a(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);